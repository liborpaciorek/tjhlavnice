{% extends 'base.html' %}
{% load static %}

{% block title %}Galerie - TJ Dru≈æba Hlavnice{% endblock %}

{% block extra_head %}
<style>
  /* Gallery Grid Styles */
  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    padding: 2rem 0;
  }

  .gallery-item {
    position: relative;
    border-radius: 1rem;
    overflow: hidden;
    background: linear-gradient(145deg, #ffffff, #f0f9ff);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    transition: all 0.4s ease;
    cursor: pointer;
    border: 1px solid rgba(34, 197, 94, 0.1);
  }

  .gallery-item:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: 0 25px 60px rgba(220, 38, 38, 0.12); /* club-red subtle shadow */
  }

  .gallery-image {
    width: 100%;
    height: 250px;
    object-fit: cover;
    transition: all 0.4s ease;
  }

  .gallery-item:hover .gallery-image {
    transform: scale(1.1);
    filter: brightness(1.1);
  }

  .gallery-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
    color: white;
    padding: 1.5rem;
    transform: translateY(100%);
    transition: all 0.4s ease;
  }

  .gallery-item:hover .gallery-overlay {
    transform: translateY(0);
  }

  .gallery-title {
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
  }

  .gallery-description {
    font-size: 0.9rem;
    opacity: 0.9;
    line-height: 1.4;
  }

  .gallery-date {
    font-size: 0.8rem;
    opacity: 0.7;
    margin-top: 0.5rem;
  }

  /* Lightbox Styles */
  .lightbox {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(5px);
  }

  .lightbox-container {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    max-width: 90vw;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .lightbox-image {
    max-width: 100%;
    max-height: 80vh;
    object-fit: contain;
    border-radius: 0.5rem;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  }

  .lightbox-info {
    background: rgba(255, 255, 255, 0.95);
    padding: 1.5rem;
    margin-top: 1rem;
    border-radius: 0.5rem;
    text-align: center;
    max-width: 600px;
    backdrop-filter: blur(10px);
  }

  .lightbox-controls {
    position: absolute;
    top: 20px;
    right: 20px;
    display: flex;
    gap: 1rem;
  }

  .lightbox-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .lightbox-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
  }

  .lightbox-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(220, 38, 38, 0.9); /* club-red */
    border: none;
    color: white;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.5rem;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .lightbox-nav:hover {
    background: rgba(153, 27, 27, 1); /* club-red-dark */
    transform: translateY(-50%) scale(1.05);
  }

  .lightbox-prev {
    left: 30px;
  }

  .lightbox-next {
    right: 30px;
  }

  /* Page Header */
  .page-header {
    background: linear-gradient(90deg, #0F172A 0%, #1E293B 50%, #0F172A 100%);
    color: white;
    text-align: center;
    padding: 4rem 2rem;
    margin-bottom: 3rem;
  }

  .page-title {
    font-size: 3.5rem;
    font-weight: bold;
    margin-bottom: 1rem;
    text-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
    color: #ffffff;
  }

  .page-subtitle {
    font-size: 1.3rem;
    opacity: 0.9;
    max-width: 600px;
    margin: 0 auto;
    color: #cbd5e1; /* light gray similar to site */
  }

  /* Empty State */
  .empty-gallery {
    text-align: center;
    padding: 4rem 2rem;
    color: #6b7280;
  }

  .empty-gallery-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.5;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .gallery-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
    
    .page-title {
      font-size: 2.5rem;
    }
    
    .lightbox-nav {
      width: 50px;
      height: 50px;
      font-size: 1.2rem;
    }
    
    .lightbox-prev {
      left: 20px;
    }
    
    .lightbox-next {
      right: 20px;
    }
  }
</style>
{% endblock %}

{% block content %}
<!-- Modern Gallery Template v2.0 - {{ "now"|date:"c" }} -->
<!-- Page Header -->
<div class="page-header">
  <h1 class="page-title">üèÜ Fotogalerie</h1>
  <p class="page-subtitle">Zachycen√© okam≈æiky na≈°ich fotbalov√Ωch z√°pas≈Ø, tr√©nink≈Ø a klubov√Ωch akc√≠</p>
</div>

<!-- Gallery Container -->
<div class="container mx-auto px-6 pb-16">
  {% if photos %}
    <div class="gallery-grid">
      {% for photo in photos %}
        {% if photo.image %}
        <div class="gallery-item" data-index="{{ forloop.counter0 }}">
          <img 
            src="{{ photo.image.url }}" 
            alt="{{ photo.title }}" 
            class="gallery-image"
            loading="lazy"
          >
          <div class="gallery-overlay">
            <div class="gallery-title">{{ photo.title }}</div>
            {% if photo.description %}
            <div class="gallery-description">{{ photo.description|truncatewords:15 }}</div>
            {% endif %}
            <div class="gallery-date">üìÖ {{ photo.uploaded_at|date:"d. m. Y" }}</div>
          </div>
        </div>
        {% endif %}
      {% endfor %}
    </div>
  {% else %}
    <div class="empty-gallery">
      <div class="empty-gallery-icon">üì∑</div>
      <h2 style="font-size: 2rem; margin-bottom: 1rem; color: #374151;">Galerie je pr√°zdn√°</h2>
      <p style="font-size: 1.1rem;">Zat√≠m zde nejsou ≈æ√°dn√© fotografie. Brzy p≈ôid√°me nov√© sn√≠mky z na≈°ich z√°pas≈Ø a akc√≠!</p>
    </div>
  {% endif %}
</div>

<!-- Modern Lightbox -->
<div id="gallery-lightbox" class="lightbox" onclick="closeLightbox()">
  <!-- Controls -->
  <div class="lightbox-controls">
    <button class="lightbox-btn" onclick="closeLightbox()" title="Zav≈ô√≠t">√ó</button>
  </div>
  
  <!-- Navigation -->
  <button class="lightbox-nav lightbox-prev" onclick="prevPhoto(event)" title="P≈ôedchoz√≠">‚Äπ</button>
  <button class="lightbox-nav lightbox-next" onclick="nextPhoto(event)" title="Dal≈°√≠">‚Ä∫</button>
  
  <!-- Content Container -->
  <div class="lightbox-container" onclick="event.stopPropagation()">
    <img id="lightbox-photo" class="lightbox-image" src="" alt="">
    <div class="lightbox-info">
      <h3 id="lightbox-title" style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem; color: #1f2937;"></h3>
      <p id="lightbox-description" style="color: #6b7280; margin-bottom: 0.5rem;"></p>
      <p id="lightbox-date" style="color: #9ca3af; font-size: 0.9rem;"></p>
      <div style="margin-top: 1rem; color: #6b7280; font-size: 0.8rem;">
        <span id="photo-counter"></span> | Pou≈æijte ≈°ipky ‚Üê ‚Üí pro navigaci nebo ESC pro zav≈ôen√≠
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
console.log('üèÜ Gallery Template v2.0 loaded at:', new Date().toISOString());

// Modern Gallery JavaScript
class GalleryViewer {
  constructor() {
    this.photos = [
      {% for photo in photos %}
      {% if photo.image %}
      {
        src: "{{ photo.image.url }}",
        title: "{{ photo.title|escapejs }}",
        description: "{{ photo.description|escapejs|default:'' }}",
        date: "{{ photo.uploaded_at|date:'d. m. Y' }}"
      }{% if not forloop.last %},{% endif %}
      {% endif %}
      {% endfor %}
    ];
    this.currentIndex = 0;
    this.lightbox = null;
    this.init();
  }

  init() {
    this.lightbox = document.getElementById('gallery-lightbox');
  this.bindEvents();
  this.attachClickHandlers();
    console.log(`üñºÔ∏è  Gallery initialized with ${this.photos.length} photos:`, this.photos);
  }

  bindEvents() {
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (this.lightbox && this.lightbox.style.display === 'block') {
        switch(e.key) {
          case 'Escape':
            console.log('‚å®Ô∏è  Escape key pressed - closing lightbox');
            this.close();
            break;
          case 'ArrowLeft':
            console.log('‚å®Ô∏è  Left arrow pressed - previous photo');
            this.prev();
            break;
          case 'ArrowRight':
            console.log('‚å®Ô∏è  Right arrow pressed - next photo');
            this.next();
            break;
        }
      }
    });
  }

  attachClickHandlers() {
    // Attach click handlers to gallery items (no inline onclick required)
    const items = document.querySelectorAll('.gallery-item');
    items.forEach((el) => {
      el.addEventListener('click', (ev) => {
        ev.stopPropagation();
        const idx = parseInt(el.getAttribute('data-index') || '0');
        console.log('üìå gallery item clicked, index=', idx);
        this.open(idx);
      });
    });
  }

  open(index) {
    console.log(`üîç Opening lightbox for index: ${index}`);
    
    if (this.photos.length === 0) {
      console.warn('‚ö†Ô∏è  No photos available');
      return;
    }

    this.currentIndex = Math.max(0, Math.min(index, this.photos.length - 1));
    console.log(`üìç Set current index to: ${this.currentIndex}`);
    
    this.lightbox.style.display = 'block';
    this.updateContent();
    document.body.style.overflow = 'hidden';
    
    console.log('‚úÖ Lightbox opened successfully');
  }

  close() {
    console.log('‚ùå Closing lightbox');
    this.lightbox.style.display = 'none';
    document.body.style.overflow = 'auto';
  }

  next() {
    if (this.photos.length > 1) {
      const oldIndex = this.currentIndex;
      this.currentIndex = (this.currentIndex + 1) % this.photos.length;
      console.log(`‚û°Ô∏è  Next photo: ${oldIndex} ‚Üí ${this.currentIndex}`);
      this.updateContent();
    }
  }

  prev() {
    if (this.photos.length > 1) {
      const oldIndex = this.currentIndex;
      this.currentIndex = (this.currentIndex - 1 + this.photos.length) % this.photos.length;
      console.log(`‚¨ÖÔ∏è  Previous photo: ${oldIndex} ‚Üí ${this.currentIndex}`);
      this.updateContent();
    }
  }

  updateContent() {
    if (this.currentIndex < 0 || this.currentIndex >= this.photos.length) {
      console.error('‚ùå Invalid current index:', this.currentIndex);
      return;
    }

    const photo = this.photos[this.currentIndex];
    console.log('üîÑ Updating content for photo:', photo);
    
    // Update image
    const imgElement = document.getElementById('lightbox-photo');
    if (imgElement) {
      imgElement.src = photo.src;
      imgElement.alt = photo.title;
    }

    // Update info
    const titleElement = document.getElementById('lightbox-title');
    if (titleElement) {
      titleElement.textContent = photo.title;
    }

    const descElement = document.getElementById('lightbox-description');
    if (descElement) {
      descElement.textContent = photo.description || '';
      descElement.style.display = photo.description ? 'block' : 'none';
    }

    const dateElement = document.getElementById('lightbox-date');
    if (dateElement) {
      dateElement.textContent = `üìÖ ${photo.date}`;
    }

    // Update counter
    const counterElement = document.getElementById('photo-counter');
    if (counterElement) {
      counterElement.textContent = `Fotografie ${this.currentIndex + 1} z ${this.photos.length}`;
    }
  }
}

// Initialize gallery
let gallery;

// Define global functions BEFORE DOM load
function openLightbox(index) {
  console.log(`üéØ Global openLightbox called with index: ${index}`);
  if (gallery) {
    gallery.open(index);
  } else {
    console.error('‚ùå Gallery not initialized yet!');
  }
}

function closeLightbox() {
  console.log('üéØ Global closeLightbox called');
  if (gallery) {
    gallery.close();
  } else {
    console.error('‚ùå Gallery not initialized yet!');
  }
}

function nextPhoto(event) {
  console.log('üéØ Global nextPhoto called');
  event.stopPropagation();
  if (gallery) {
    gallery.next();
  } else {
    console.error('‚ùå Gallery not initialized yet!');
  }
}

function prevPhoto(event) {
  console.log('üéØ Global prevPhoto called');
  event.stopPropagation();
  if (gallery) {
    gallery.prev();
  } else {
    console.error('‚ùå Gallery not initialized yet!');
  }
}

// Make functions globally accessible immediately
window.openLightbox = openLightbox;
window.closeLightbox = closeLightbox;
window.nextPhoto = nextPhoto;
window.prevPhoto = prevPhoto;

console.log('üåç Global functions registered:', {
  openLightbox: typeof window.openLightbox,
  closeLightbox: typeof window.closeLightbox,
  nextPhoto: typeof window.nextPhoto,
  prevPhoto: typeof window.prevPhoto
});

document.addEventListener('DOMContentLoaded', function() {
  console.log('üöÄ DOM loaded, initializing gallery...');
  gallery = new GalleryViewer();
  console.log('‚úÖ Gallery initialization complete');
});

// Legacy compatibility - add the old function name as well
window.openLightboxByPhotoIndex = function(element) {
  console.log('‚ö†Ô∏è  Legacy openLightboxByPhotoIndex called, redirecting...');
  const index = parseInt(element.getAttribute('data-index') || element.getAttribute('data-photo-index') || '0');
  openLightbox(index);
};

console.log('üìù Gallery script loaded successfully');
</script>
{% endblock %}
